import{_ as V,P as U,D as E}from"./DelModal-1bd397fe.js";import{c as M,l as T,_ as I,r as f,o as a,a as d,b as e,d as r,w as A,n as b,e as c,g as h,F as y,h as w,i as k,v as D,j as S,t as v,f as C,m as F}from"./index-043017a7.js";M({generateMessage:T("zh_TW",{names:{imageUrl:"主要圖片",title:"標題",category:"分類",unit:"單位",origin_price:"原價",price:"售價",description:"產品描述",content:"說明內容"}})});const R={mixins:[V],props:["temp","isNew"],emits:["updateProd"],data(){return{modal:{},tempProduct:{},previewImg:{},imgFile:{},isLoading:!1,isDisabled:!1}},watch:{temp(l){l.imagesUrl?l.imagesUrl=l.imagesUrl.filter(s=>s!==""):l.imagesUrl=[],this.tempProduct=l,this.previewImg={}}},methods:{onSubmit(l){this.tempProduct.imagesUrl=this.tempProduct.imagesUrl.filter(s=>s!==""),this.$emit("updateProd",this.tempProduct,this.tempProduct.id)},onInvalidSubmit({values:l,errors:s}){const m=Object.keys(s)[0];document.querySelector(`#${m}`).scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>alert(`${s[m]}`),500)},resetForm(){this.$refs.mainForm.resetForm()},previewUpload(l){this.imgFile=l.target.files[0],this.previewImg.url=URL.createObjectURL(l.target.files[0]),this.previewImg.alt=l.target.files[0].name},clearImg(l){l==="preview"?this.previewImg={}:l==="link"&&(this.tempProduct.imageUrl="")},uploadImg(){this.isLoading=!0,this.isDisabled=!0;const l=new FormData;l.append("file-to-upload",this.imgFile);const{VITE_API:s,VITE_API_PATH:m}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},_=`${s}/api/${m}/admin/upload`;this.$http.post(_,l).then(t=>{this.previewImg={},this.tempProduct.imageUrl=t.data.imageUrl,alert("成功上傳圖片")}).catch(t=>{alert(`圖片上傳失敗，錯誤代碼：${t.response.status}`)}).finally(()=>{this.isLoading=!1,this.isDisabled=!1})}}},N={ref:"modal",class:"modal fade","data-bs-keyboard":"false",tabindex:"-1"},L={class:"modal-dialog modal-xl modal-dialog-scrollable"},O={class:"modal-header bg-dark"},q={class:"modal-title text-light",id:"productModalLabel"},B={key:0},H={key:1},$=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},z={class:"container-fluid"},W={class:"row"},G={class:"col-md-4"},J={class:"mb-5"},K=e("h3",{class:"mb-0 fs-5"},[h("主要圖片"),e("span",{class:"text-danger ms-1"},"*")],-1),Q=e("label",{for:"imageUrl",class:"form-label mt-2 mb-1"},"請輸入圖片連結",-1),X={class:"position-relative mb-1"},Y={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Z=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),ee=[Z],te=e("label",{for:"uploadImageUrl",class:"form-label mt-2 mb-1"},"或上傳圖片",-1),se={key:0,for:"uploadImageUrl",class:"form-label mb-1 btn btn-outline-secondary w-100 position-relative"},oe={key:1,class:"position-relative"},le=["src","alt"],ie=e("span",{class:"position-absolute top-0 badge text-bg-light opacity-50 fs-6 m-1"},"上傳預覽",-1),ne=["disabled"],ae={key:0,class:"position-relative"},de=["src"],re=e("span",{class:"position-absolute top-0 badge text-bg-light opacity-50 fs-6 m-1"},"主要圖片",-1),ce=e("h3",{class:"mb-3"},"多圖新增",-1),me=["onUpdate:modelValue"],ue={key:0,class:"position-relative my-3"},pe=["src","alt"],_e=["onClick"],be={class:"col-md-8"},he={class:"mb-3"},ge=e("label",{for:"title",class:"form-label"},[h("標題"),e("span",{class:"text-danger ms-1"},"*")],-1),ve={class:"position-relative mb-1"},fe={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Pe=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),ye=[Pe],xe={class:"mb-3 row"},ke={class:"col"},Ie=e("label",{for:"category",class:"form-label"},[h("分類"),e("span",{class:"text-danger ms-1"},"*")],-1),we={class:"position-relative mb-1"},Ve={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Ue=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Ee=[Ue],Me={class:"col"},Te=e("label",{for:"unit",class:"form-label"},[h("單位"),e("span",{class:"text-danger ms-1"},"*")],-1),Ae={class:"position-relative mb-1"},De={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Se=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Ce=[Se],Fe={class:"mb-3 row"},Re={class:"col"},Ne=e("label",{for:"origin_price",class:"form-label"},[h("原價"),e("span",{class:"text-danger ms-1"},"*")],-1),Le={class:"position-relative mb-1"},Oe={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},qe=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Be=[qe],He={class:"col"},$e=e("label",{for:"price",class:"form-label"},[h("售價"),e("span",{class:"text-danger ms-1"},"*")],-1),je={class:"position-relative mb-1"},ze={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},We=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Ge=[We],Je={class:"mb-3"},Ke=e("label",{for:"description",class:"form-label"},[h("產品描述"),e("span",{class:"text-danger ms-1"},"*")],-1),Qe={class:"position-relative mb-1"},Xe={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Ye=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Ze=[Ye],et={class:"mb-3"},tt=e("label",{for:"content",class:"form-label"},[h("說明內容"),e("span",{class:"text-danger ms-1"},"*")],-1),st={class:"position-relative mb-1"},ot={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},lt=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),it=[lt],nt={class:"form-check"},at=e("label",{class:"form-check-label",for:"is_enable"},"是否啟用",-1),dt=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消"),e("button",{type:"submit",class:"btn btn-primary"},"確認")],-1);function rt(l,s,m,_,t,n){const u=f("VField"),p=f("ErrorMessage"),g=f("VForm");return a(),d("div",N,[e("div",L,[r(g,{ref:"mainForm",class:"modal-content border-0",onSubmit:n.onSubmit,onInvalidSubmit:n.onInvalidSubmit},{default:A(({errors:i})=>[e("div",O,[e("h5",q,[m.isNew?(a(),d("span",B,"新增產品")):(a(),d("span",H,"編輯產品"))]),$]),e("div",j,[e("div",z,[e("div",W,[e("div",G,[e("div",J,[K,Q,e("div",X,[r(u,{type:"text",name:"imageUrl",id:"imageUrl",class:b(["form-control",{"border-danger":i.imageUrl}]),placeholder:"請輸入圖片連結",rules:"required",modelValue:t.tempProduct.imageUrl,"onUpdate:modelValue":s[0]||(s[0]=o=>t.tempProduct.imageUrl=o)},null,8,["modelValue","class"]),i.imageUrl?(a(),d("div",Y,ee)):c("",!0)]),r(p,{name:"imageUrl",class:"d-block mb-0 text-danger"}),e("form",null,[te,t.previewImg.url?c("",!0):(a(),d("label",se,[h("選擇圖片 "),e("input",{type:"file",id:"uploadImageUrl",class:"opacity-0 position-absolute start-0",onChange:s[1]||(s[1]=o=>n.previewUpload(o))},null,32)])),t.previewImg.url?(a(),d("div",oe,[e("img",{src:t.previewImg.url,alt:t.previewImg.alt,class:"d-block mb-1 w-100"},null,8,le),ie,e("span",{class:"position-absolute top-0 start-100 translate-middle rounded-circle badge text-bg-danger pointer",onClick:s[2]||(s[2]=o=>n.clearImg("preview"))},"x")])):c("",!0),t.previewImg.url?(a(),d("div",{key:2,class:b({spinner:t.isLoading})},[e("button",{type:"button",class:"btn btn-secondary w-100",onClick:s[3]||(s[3]=(...o)=>n.uploadImg&&n.uploadImg(...o)),disabled:t.isDisabled},"確定上傳",8,ne)],2)):c("",!0)]),t.tempProduct.imageUrl&&!t.previewImg.url?(a(),d("div",ae,[e("img",{src:t.tempProduct.imageUrl,alt:"主要圖片",class:"d-block w-100 my-3"},null,8,de),re,e("span",{class:"position-absolute top-0 start-100 translate-middle rounded-circle badge text-bg-danger pointer",onClick:s[4]||(s[4]=o=>n.clearImg("link"))},"x")])):c("",!0)]),e("div",null,[ce,(a(!0),d(y,null,w(t.tempProduct.imagesUrl,(o,P)=>(a(),d(y,{key:o},[k(e("input",{type:"text",name:"imagesUrl",class:"form-control mb-2",placeholder:"請輸入圖片連結","onUpdate:modelValue":x=>t.tempProduct.imagesUrl[P]=x},null,8,me),[[D,t.tempProduct.imagesUrl[P]]]),o?(a(),d("div",ue,[e("img",{class:"w-100",src:o,alt:`多圖-0${P+1}`},null,8,pe),e("span",{class:"position-absolute top-0 start-100 translate-middle rounded-circle badge text-bg-danger pointer",onClick:x=>t.tempProduct.imagesUrl.splice(P,1)},"x",8,_e)])):c("",!0)],64))),128)),e("button",{type:"button",class:"btn btn-outline-primary w-100",onClick:s[5]||(s[5]=o=>t.tempProduct.imagesUrl.push(""))},"新增更多圖片")])]),e("div",be,[e("div",he,[ge,e("div",ve,[r(u,{type:"text",name:"title",id:"title",class:b(["form-control",{"border-danger":i.title}]),placeholder:"請輸入標題",rules:"required",modelValue:t.tempProduct.title,"onUpdate:modelValue":s[6]||(s[6]=o=>t.tempProduct.title=o)},null,8,["modelValue","class"]),i.title?(a(),d("div",fe,ye)):c("",!0)]),r(p,{name:"title",class:"d-block mb-0 text-danger"})]),e("div",xe,[e("div",ke,[Ie,e("div",we,[r(u,{type:"text",name:"category",id:"category",class:b(["form-control",{"border-danger":i.category}]),placeholder:"請輸入分類",rules:"required",modelValue:t.tempProduct.category,"onUpdate:modelValue":s[7]||(s[7]=o=>t.tempProduct.category=o)},null,8,["modelValue","class"]),i.category?(a(),d("div",Ve,Ee)):c("",!0)]),r(p,{name:"category",class:"d-block mb-0 text-danger"})]),e("div",Me,[Te,e("div",Ae,[r(u,{type:"text",name:"unit",id:"unit",class:b(["form-control",{"border-danger":i.unit}]),placeholder:"請輸入單位",rules:"required",modelValue:t.tempProduct.unit,"onUpdate:modelValue":s[8]||(s[8]=o=>t.tempProduct.unit=o)},null,8,["modelValue","class"]),i.unit?(a(),d("div",De,Ce)):c("",!0)]),r(p,{name:"unit",class:"d-block mb-0 text-danger"})])]),e("div",Fe,[e("div",Re,[Ne,e("div",Le,[r(u,{type:"text",name:"origin_price",id:"origin_price",class:b(["form-control",{"border-danger":i.origin_price}]),placeholder:"請輸入原價",rules:"required|numeric|min_value:0",modelValue:t.tempProduct.origin_price,"onUpdate:modelValue":s[9]||(s[9]=o=>t.tempProduct.origin_price=o),modelModifiers:{number:!0}},null,8,["modelValue","class"]),i.origin_price?(a(),d("div",Oe,Be)):c("",!0)]),r(p,{name:"origin_price",class:"d-block mb-0 text-danger"})]),e("div",He,[$e,e("div",je,[r(u,{type:"text",name:"price",id:"price",class:b(["form-control",{"border-danger":i.price}]),placeholder:"請輸入售價",rules:"required|numeric|min_value:0",modelValue:t.tempProduct.price,"onUpdate:modelValue":s[10]||(s[10]=o=>t.tempProduct.price=o),modelModifiers:{number:!0}},null,8,["modelValue","class"]),i.price?(a(),d("div",ze,Ge)):c("",!0)]),r(p,{name:"price",class:"d-block mb-0 text-danger"})])]),e("div",Je,[Ke,e("div",Qe,[r(u,{as:"textarea",name:"description",id:"description",rows:"3",class:b(["form-control",{"border-danger":i.description}]),placeholder:"請輸入產品描述",rules:"required",modelValue:t.tempProduct.description,"onUpdate:modelValue":s[11]||(s[11]=o=>t.tempProduct.description=o)},null,8,["modelValue","class"]),i.description?(a(),d("div",Xe,Ze)):c("",!0)]),r(p,{name:"description",class:"d-block mb-0 text-danger"})]),e("div",et,[tt,e("div",st,[r(u,{as:"textarea",name:"content",id:"content",rows:"3",class:b(["form-control",{"border-danger":i.content}]),placeholder:"請輸入說明內容",rules:"required",modelValue:t.tempProduct.content,"onUpdate:modelValue":s[12]||(s[12]=o=>t.tempProduct.content=o)},null,8,["modelValue","class"]),i.content?(a(),d("div",ot,it)):c("",!0)]),r(p,{name:"content",class:"d-block mb-0 text-danger"})]),e("div",nt,[k(e("input",{type:"checkbox",name:"is_enabled",id:"is_enable",class:"form-check-input","onUpdate:modelValue":s[13]||(s[13]=o=>t.tempProduct.is_enabled=o)},null,512),[[S,t.tempProduct.is_enabled]]),at])])])])]),dt]),_:1},8,["onSubmit","onInvalidSubmit"])])],512)}const ct=I(R,[["render",rt]]),mt={components:{Pagination:U,ProductModal:ct,DelModal:E},data(){return{products:[],tempProduct:{},pagination:{},isNew:""}},methods:{getProducts(l=1){const s=this.$loading.show(),{VITE_API:m,VITE_API_PATH:_}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=`${m}/api/${_}/admin/products?page=${l}`;this.$http.get(t).then(n=>{this.products=n.data.products,this.pagination=n.data.pagination}).catch(n=>{alert(`取得產品失敗，錯誤代碼：${n.response.status}`)}).finally(()=>s.hide())},openModal(l,s={}){if(this.tempProduct={...s},l==="del"){this.$refs.delModal.openModal();return}else l==="new"?(this.isNew=!0,this.$refs.productModal.resetForm()):l==="edit"&&(this.isNew=!1);this.$refs.productModal.openModal()},updateProd(l,s){const m=this.$loading.show(),{VITE_API:_,VITE_API_PATH:t}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let n=`${_}/api/${t}/admin/product`,u="post",p="新增";this.isNew===!1&&(n+=`/${s}`,u="put",p="編輯"),this.$http[u](n,{data:{...l}}).then(g=>{setTimeout(()=>alert(`${g.data.message}`),1e3),this.$refs.productModal.hideModal(),this.getProducts()}).catch(g=>{alert(`${p}產品失敗，錯誤代碼：${g.response.status}`)}).finally(()=>m.hide())},delProduct(l){const s=this.$loading.show(),{VITE_API:m,VITE_API_PATH:_}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=`${m}/api/${_}/admin/product/${l}`;this.$http.delete(t).then(n=>{setTimeout(()=>alert(`${n.data.message}`),1e3),this.$refs.delModal.hideModal(),this.getProducts()}).catch(n=>{alert(`刪除產品失敗，錯誤代碼：${n.response.status}`)}).finally(()=>s.hide())}},mounted(){this.getProducts()}},ut={class:"container py-5"},pt=e("h2",{class:"mb-3'"},"產品列表",-1),_t={class:"position-relative py-3"},bt={class:"table align-middle"},ht=e("thead",null,[e("tr",null,[e("th",null,"分類"),e("th",null,"產品名稱"),e("th",null,"原價"),e("th",null,"售價"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),gt=["onClick"],vt=["onClick"];function ft(l,s,m,_,t,n){const u=f("Pagination"),p=f("ProductModal"),g=f("DelModal");return a(),d("div",ut,[pt,e("div",_t,[e("button",{type:"button",onClick:s[0]||(s[0]=i=>n.openModal("new")),class:"position-absolute bottom-100 end-0 btn btn-primary"},"建立新的產品"),e("table",bt,[ht,e("tbody",null,[(a(!0),d(y,null,w(t.products,i=>(a(),d("tr",{key:i.id},[e("td",null,v(i.category),1),e("td",null,v(i.title),1),e("td",null,v(i.origin_price),1),e("td",null,v(i.price),1),e("td",{class:b([i.is_enabled?"text-success":"text-danger"])},v(i.is_enabled?"啟用":"未啟用"),3),e("td",null,[e("button",{type:"button",class:"mb-1 mb-md-0 btn btn-outline-primary me-2",onClick:o=>n.openModal("edit",i)},"編輯",8,gt),e("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>n.openModal("del",i)},"刪除",8,vt)])]))),128))])])]),e("p",null,"此頁共有 "+v(t.products.length)+" 項產品",1),t.pagination.total_pages?(a(),C(u,F({key:0},t.pagination,{onSwitchPage:n.getProducts}),null,16,["onSwitchPage"])):c("",!0),r(p,{ref:"productModal",temp:{...t.tempProduct},isNew:t.isNew,onUpdateProd:n.updateProd},null,8,["temp","isNew","onUpdateProd"]),r(g,{ref:"delModal",temp:{...t.tempProduct},onDelData:n.delProduct},null,8,["temp","onDelData"])])}const xt=I(mt,[["render",ft]]);export{xt as default};
