import{_ as U,P as E,D as M}from"./DelModal-6af98f6b.js";import{c as T,l as A,_ as w,r as f,o as a,a as d,b as e,d as r,w as D,n as b,e as p,g as h,F as I,h as V,i as k,v as S,j as C,k as N,t as v,f as R,m as L}from"./index-1a5b6631.js";T({generateMessage:A("zh_TW",{names:{imageUrl:"主要圖片",title:"標題",category:"分類",unit:"單位",origin_price:"原價",price:"售價",description:"產品描述",content:"說明內容"}})});const F={mixins:[U],props:["temp","isNew"],emits:["updateProd"],data(){return{modal:{},tempProduct:this.temp,previewImg:{},imgFile:{},isLoading:!1,isDisabled:!1}},watch:{temp(n){this.tempProduct=n}},methods:{onSubmit(n){this.$emit("updateProd",this.tempProduct,this.tempProduct.id)},onInvalidSubmit({values:n,errors:s}){const c=Object.keys(s)[0];document.querySelector(`#${c}`).scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>alert(`${s[c]}`),500)},previewUpload(n){this.imgFile=n.target.files[0],this.previewImg.url=URL.createObjectURL(n.target.files[0]),this.previewImg.alt=n.target.files[0].name},clearImg(n){n==="preview"?this.previewImg={}:n==="link"&&(this.tempProduct.imageUrl="")},uploadImg(){this.isLoading=!0,this.isDisabled=!0;const n=new FormData;n.append("file-to-upload",this.imgFile);const{VITE_API:s,VITE_API_PATH:c}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},_=`${s}/api/${c}/admin/upload`;this.$http.post(_,n).then(t=>{this.previewImg={},this.tempProduct.imageUrl=t.data.imageUrl,console.log(this.tempProduct.imageUrl),alert("成功上傳圖片")}).catch(t=>{alert(`圖片上傳失敗，錯誤代碼：${t.response.status}`)}).finally(()=>{this.isLoading=!1,this.isDisabled=!1})}}},O={ref:"modal",class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1"},q={class:"modal-dialog modal-xl modal-dialog-scrollable"},B={class:"modal-header bg-dark"},H={class:"modal-title text-light",id:"productModalLabel"},j={key:0},z={key:1},W=["onClick"],G={class:"modal-body"},J={class:"container-fluid"},K={class:"row"},Q={class:"col-md-4"},X={class:"mb-5"},Y=e("h3",{class:"mb-0 fs-5"},[h("主要圖片"),e("span",{class:"text-danger ms-1"},"*")],-1),Z=e("label",{for:"imageUrl",class:"form-label mt-2 mb-1"},"請輸入圖片連結",-1),$={class:"position-relative mb-1"},ee={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},te=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),se=[te],oe=e("label",{for:"uploadImageUrl",class:"form-label mt-2 mb-1"},"或上傳圖片",-1),le={key:0,for:"uploadImageUrl",class:"form-label mb-1 btn btn-outline-secondary w-100 position-relative"},ie={key:1,class:"position-relative"},ne=["src","alt"],ae=e("span",{class:"position-absolute top-0 badge text-bg-light opacity-50 fs-6 m-1"},"上傳預覽",-1),de=["disabled"],re={key:0,class:"position-relative"},ce=["src"],me=e("span",{class:"position-absolute top-0 badge text-bg-light opacity-50 fs-6 m-1"},"主要圖片",-1),ue=e("h3",{class:"mb-3"},"多圖新增",-1),pe=["onUpdate:modelValue"],_e=["src"],be=["onClick"],he=e("hr",{class:"my-4"},null,-1),ge={class:"col-md-8"},ve={class:"mb-3"},fe=e("label",{for:"title",class:"form-label"},[h("標題"),e("span",{class:"text-danger ms-1"},"*")],-1),Pe={class:"position-relative mb-1"},ye={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},ke=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),xe=[ke],we={class:"mb-3 row"},Ie={class:"col"},Ve=e("label",{for:"category",class:"form-label"},[h("分類"),e("span",{class:"text-danger ms-1"},"*")],-1),Ue={class:"position-relative mb-1"},Ee={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Me=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Te=[Me],Ae={class:"col"},De=e("label",{for:"unit",class:"form-label"},[h("單位"),e("span",{class:"text-danger ms-1"},"*")],-1),Se={class:"position-relative mb-1"},Ce={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Ne=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Re=[Ne],Le={class:"mb-3 row"},Fe={class:"col"},Oe=e("label",{for:"origin_price",class:"form-label"},[h("原價"),e("span",{class:"text-danger ms-1"},"*")],-1),qe={class:"position-relative mb-1"},Be={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},He=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),je=[He],ze={class:"col"},We=e("label",{for:"price",class:"form-label"},[h("售價"),e("span",{class:"text-danger ms-1"},"*")],-1),Ge={class:"position-relative mb-1"},Je={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Ke=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Qe=[Ke],Xe={class:"mb-3"},Ye=e("label",{for:"description",class:"form-label"},[h("產品描述"),e("span",{class:"text-danger ms-1"},"*")],-1),Ze={class:"position-relative mb-1"},$e={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},et=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),tt=[et],st={class:"mb-3"},ot=e("label",{for:"content",class:"form-label"},[h("說明內容"),e("span",{class:"text-danger ms-1"},"*")],-1),lt={class:"position-relative mb-1"},it={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},nt=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),at=[nt],dt={class:"form-check"},rt=e("label",{class:"form-check-label",for:"is_enable"},"是否啟用",-1),ct={class:"modal-footer"},mt=["onClick"],ut=e("button",{type:"submit",class:"btn btn-primary"},"確認",-1);function pt(n,s,c,_,t,i){const m=f("VField"),u=f("ErrorMessage"),g=f("VForm");return a(),d("div",O,[e("div",q,[r(g,{class:"modal-content border-0",onSubmit:i.onSubmit,onInvalidSubmit:i.onInvalidSubmit},{default:D(({errors:l,handleReset:P})=>[e("div",B,[e("h5",H,[c.isNew?(a(),d("span",j,"新增產品")):(a(),d("span",z,"編輯產品"))]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close",onClick:()=>{P(),t.previewImg={}}},null,8,W)]),e("div",G,[e("div",J,[e("div",K,[e("div",Q,[e("div",X,[Y,Z,e("div",$,[r(m,{type:"text",name:"imageUrl",id:"imageUrl",class:b(["form-control",{"border-danger":l.imageUrl}]),placeholder:"請輸入圖片連結",rules:"required",modelValue:t.tempProduct.imageUrl,"onUpdate:modelValue":s[0]||(s[0]=o=>t.tempProduct.imageUrl=o)},null,8,["modelValue","class"]),l.imageUrl?(a(),d("div",ee,se)):p("",!0)]),r(u,{name:"imageUrl",class:"d-block mb-0 text-danger"}),e("form",null,[oe,t.previewImg.url?p("",!0):(a(),d("label",le,[h("選擇圖片 "),e("input",{type:"file",id:"uploadImageUrl",class:"opacity-0 position-absolute start-0",onChange:s[1]||(s[1]=o=>i.previewUpload(o))},null,32)])),t.previewImg.url?(a(),d("div",ie,[e("img",{src:t.previewImg.url,alt:t.previewImg.alt,class:"d-block mb-1 w-100"},null,8,ne),ae,e("span",{class:"position-absolute top-0 start-100 translate-middle rounded-circle badge text-bg-danger pointer",onClick:s[2]||(s[2]=o=>i.clearImg("preview"))},"x")])):p("",!0),t.previewImg.url?(a(),d("div",{key:2,class:b({spinner:t.isLoading})},[e("button",{type:"button",class:"btn btn-secondary w-100",onClick:s[3]||(s[3]=(...o)=>i.uploadImg&&i.uploadImg(...o)),disabled:t.isDisabled},"確定上傳",8,de)],2)):p("",!0)]),t.tempProduct.imageUrl&&!t.previewImg.url?(a(),d("div",re,[e("img",{src:t.tempProduct.imageUrl,alt:"主要圖片",class:"d-block w-100 my-3"},null,8,ce),me,e("span",{class:"position-absolute top-0 start-100 translate-middle rounded-circle badge text-bg-danger pointer",onClick:s[4]||(s[4]=o=>i.clearImg("link"))},"x")])):p("",!0)]),e("div",null,[ue,(a(!0),d(I,null,V(t.tempProduct.imagesUrl,(o,y)=>(a(),d("div",{key:o},[k(e("input",{type:"text",name:"imagesUrl",class:"form-control mb-2",placeholder:"請輸入圖片連結","onUpdate:modelValue":x=>t.tempProduct.imagesUrl[y]=x},null,8,pe),[[S,t.tempProduct.imagesUrl[y]]]),k(e("img",{class:"mb-2 w-100",src:o,alt:"圖片"},null,8,_e),[[N,o]]),e("button",{type:"button",class:"btn btn-outline-danger w-100",onClick:x=>t.tempProduct.imagesUrl.splice(y,1)},"刪除圖片",8,be),he]))),128)),e("button",{type:"button",class:"btn btn-outline-primary w-100",onClick:s[5]||(s[5]=o=>t.tempProduct.imagesUrl.push(""))},"新增更多圖片")])]),e("div",ge,[e("div",ve,[fe,e("div",Pe,[r(m,{type:"text",name:"title",id:"title",class:b(["form-control",{"border-danger":l.title}]),placeholder:"請輸入標題",rules:"required",modelValue:t.tempProduct.title,"onUpdate:modelValue":s[6]||(s[6]=o=>t.tempProduct.title=o)},null,8,["modelValue","class"]),l.title?(a(),d("div",ye,xe)):p("",!0)]),r(u,{name:"title",class:"d-block mb-0 text-danger"})]),e("div",we,[e("div",Ie,[Ve,e("div",Ue,[r(m,{type:"text",name:"category",id:"category",class:b(["form-control",{"border-danger":l.category}]),placeholder:"請輸入分類",rules:"required",modelValue:t.tempProduct.category,"onUpdate:modelValue":s[7]||(s[7]=o=>t.tempProduct.category=o)},null,8,["modelValue","class"]),l.category?(a(),d("div",Ee,Te)):p("",!0)]),r(u,{name:"category",class:"d-block mb-0 text-danger"})]),e("div",Ae,[De,e("div",Se,[r(m,{type:"text",name:"unit",id:"unit",class:b(["form-control",{"border-danger":l.unit}]),placeholder:"請輸入單位",rules:"required",modelValue:t.tempProduct.unit,"onUpdate:modelValue":s[8]||(s[8]=o=>t.tempProduct.unit=o)},null,8,["modelValue","class"]),l.unit?(a(),d("div",Ce,Re)):p("",!0)]),r(u,{name:"unit",class:"d-block mb-0 text-danger"})])]),e("div",Le,[e("div",Fe,[Oe,e("div",qe,[r(m,{type:"text",name:"origin_price",id:"origin_price",class:b(["form-control",{"border-danger":l.origin_price}]),placeholder:"請輸入原價",rules:"required|numeric|min_value:0",modelValue:t.tempProduct.origin_price,"onUpdate:modelValue":s[9]||(s[9]=o=>t.tempProduct.origin_price=o),modelModifiers:{number:!0}},null,8,["modelValue","class"]),l.origin_price?(a(),d("div",Be,je)):p("",!0)]),r(u,{name:"origin_price",class:"d-block mb-0 text-danger"})]),e("div",ze,[We,e("div",Ge,[r(m,{type:"text",name:"price",id:"price",class:b(["form-control",{"border-danger":l.price}]),placeholder:"請輸入售價",rules:"required|numeric|min_value:0",modelValue:t.tempProduct.price,"onUpdate:modelValue":s[10]||(s[10]=o=>t.tempProduct.price=o),modelModifiers:{number:!0}},null,8,["modelValue","class"]),l.price?(a(),d("div",Je,Qe)):p("",!0)]),r(u,{name:"price",class:"d-block mb-0 text-danger"})])]),e("div",Xe,[Ye,e("div",Ze,[r(m,{as:"textarea",name:"description",id:"description",rows:"3",class:b(["form-control",{"border-danger":l.description}]),placeholder:"請輸入產品描述",rules:"required",modelValue:t.tempProduct.description,"onUpdate:modelValue":s[11]||(s[11]=o=>t.tempProduct.description=o)},null,8,["modelValue","class"]),l.description?(a(),d("div",$e,tt)):p("",!0)]),r(u,{name:"description",class:"d-block mb-0 text-danger"})]),e("div",st,[ot,e("div",lt,[r(m,{as:"textarea",name:"content",id:"content",rows:"3",class:b(["form-control",{"border-danger":l.content}]),placeholder:"請輸入說明內容",rules:"required",modelValue:t.tempProduct.content,"onUpdate:modelValue":s[12]||(s[12]=o=>t.tempProduct.content=o)},null,8,["modelValue","class"]),l.content?(a(),d("div",it,at)):p("",!0)]),r(u,{name:"content",class:"d-block mb-0 text-danger"})]),e("div",dt,[k(e("input",{type:"checkbox",name:"is_enabled",id:"is_enable",class:"form-check-input","onUpdate:modelValue":s[13]||(s[13]=o=>t.tempProduct.is_enabled=o)},null,512),[[C,t.tempProduct.is_enabled]]),rt])])])])]),e("div",ct,[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:()=>{P(),t.previewImg={}}},"取消",8,mt),ut])]),_:1},8,["onSubmit","onInvalidSubmit"])])],512)}const _t=w(F,[["render",pt]]),bt={components:{Pagination:E,ProductModal:_t,DelModal:M},data(){return{products:[],tempProduct:{},pagination:{},isNew:""}},methods:{getProducts(n=1){const s=this.$loading.show(),{VITE_API:c,VITE_API_PATH:_}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=`${c}/api/${_}/admin/products?page=${n}`;this.$http.get(t).then(i=>{this.products=i.data.products,this.pagination=i.data.pagination}).catch(i=>{alert(`取得產品失敗，錯誤代碼：${i.response.status}`)}).finally(()=>s.hide())},openModal(n,s){if(this.tempProduct={...s},n==="del"){this.$refs.delModal.openModal();return}else n==="new"?(this.isNew=!0,this.tempProduct={imagesUrl:[]}):n==="edit"&&(this.isNew=!1);this.$refs.productModal.openModal()},updateProd(n,s){const c=this.$loading.show(),{VITE_API:_,VITE_API_PATH:t}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let i=`${_}/api/${t}/admin/product`,m="post",u="新增";this.isNew===!1&&(i+=`/${s}`,m="put",u="編輯"),this.$http[m](i,{data:{...n}}).then(g=>{setTimeout(()=>alert(`${g.data.message}`),1e3),this.$refs.productModal.hideModal(),this.getProducts()}).catch(g=>{alert(`${u}產品失敗，錯誤代碼：${g.response.status}`)}).finally(()=>c.hide())},delProduct(n){const s=this.$loading.show(),{VITE_API:c,VITE_API_PATH:_}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=`${c}/api/${_}/admin/product/${n}`;this.$http.delete(t).then(i=>{setTimeout(()=>alert(`${i.data.message}`),1e3),this.$refs.delModal.hideModal(),this.getProducts()}).catch(i=>{alert(`刪除產品失敗，錯誤代碼：${i.response.status}`)}).finally(()=>s.hide())}},mounted(){this.getProducts()}},ht={class:"container py-5"},gt=e("h2",{class:"mb-3'"},"產品列表",-1),vt={class:"position-relative py-3"},ft={class:"table align-middle"},Pt=e("thead",null,[e("tr",null,[e("th",null,"分類"),e("th",null,"產品名稱"),e("th",null,"原價"),e("th",null,"售價"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),yt=["onClick"],kt=["onClick"];function xt(n,s,c,_,t,i){const m=f("Pagination"),u=f("ProductModal"),g=f("DelModal");return a(),d("div",ht,[gt,e("div",vt,[e("button",{type:"button",onClick:s[0]||(s[0]=l=>i.openModal("new")),class:"position-absolute bottom-100 end-0 btn btn-primary"},"建立新的產品"),e("table",ft,[Pt,e("tbody",null,[(a(!0),d(I,null,V(t.products,l=>(a(),d("tr",{key:l.id},[e("td",null,v(l.category),1),e("td",null,v(l.title),1),e("td",null,v(l.origin_price),1),e("td",null,v(l.price),1),e("td",{class:b([l.is_enabled?"text-success":"text-danger"])},v(l.is_enabled?"啟用":"未啟用"),3),e("td",null,[e("button",{type:"button",class:"mb-1 mb-md-0 btn btn-outline-primary me-2",onClick:P=>i.openModal("edit",l)},"編輯",8,yt),e("button",{type:"button",class:"btn btn-outline-danger",onClick:P=>i.openModal("del",l)},"刪除",8,kt)])]))),128))])])]),e("p",null,"此頁共有 "+v(t.products.length)+" 項產品",1),t.pagination.total_pages?(a(),R(m,L({key:0},t.pagination,{onSwitchPage:i.getProducts}),null,16,["onSwitchPage"])):p("",!0),r(u,{ref:"productModal",temp:{...t.tempProduct},isNew:t.isNew,onUpdateProd:i.updateProd},null,8,["temp","isNew","onUpdateProd"]),r(g,{ref:"delModal",temp:{...t.tempProduct},onDelData:i.delProduct},null,8,["temp","onDelData"])])}const Vt=w(bt,[["render",xt]]);export{Vt as default};
