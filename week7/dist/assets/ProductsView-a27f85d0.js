import{_ as y,o as a,a as d,b as e,h as x,n as p,F as V,i as I,t as g,M as E,c as T,l as A,r as v,d as u,w as $,e as h,g as b,j as w,v as C,k as D,m as S,f as N,p as L}from"./index-45bfa4dc.js";const R={props:["has_pre","total_pages","current_page","has_next"],emits:["switchPage"],methods:{switchPage(i){i!==this.current_page&&this.$emit("switchPage",i)}}},F={class:"pagination"},O=e("span",{"aria-hidden":"true"},"«",-1),q=[O],B=["onClick"],H=e("span",{"aria-hidden":"true"},"»",-1),z=[H];function j(i,s,c,_,t,o){return a(),d("ul",F,[e("li",{class:p(["page-item",{disabled:!c.has_pre}])},[e("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:s[0]||(s[0]=x(r=>o.switchPage(c.current_page-1),["prevent"]))},q)],2),(a(!0),d(V,null,I(c.total_pages,r=>(a(),d("li",{key:r,class:p(["page-item",{active:r===c.current_page}])},[e("a",{class:"page-link",href:"#",onClick:x(m=>o.switchPage(r),["prevent"])},g(r),9,B)],2))),128)),e("li",{class:p(["page-item",{disabled:!c.has_next}])},[e("a",{class:"page-link",href:"#","aria-label":"Next",onClick:s[1]||(s[1]=x(r=>o.switchPage(c.current_page+1),["prevent"]))},z)],2)])}const W=y(R,[["render",j]]),M={mounted(){this.modal=new E(this.$refs.modal)},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}}};T({generateMessage:A("zh_TW",{names:{imageUrl:"主要圖片",title:"標題",category:"分類",unit:"單位",origin_price:"原價",price:"售價",description:"產品描述",content:"說明內容"}})});const G={mixins:[M],props:["temp","isNew"],emits:["updateProd"],data(){return{modal:{},tempProduct:this.temp,previewImg:{url:"",alt:""},imgFile:{},isLoading:!1,isDisabled:!1}},watch:{temp(i){this.tempProduct=i}},methods:{onSubmit(i){this.$emit("updateProd",this.tempProduct,this.tempProduct.id)},previewUpload(i){this.file=i.target.files[0],this.previewImg.url=URL.createObjectURL(i.target.files[0]),this.previewImg.alt=i.target.files[0].name},uploadImg(){this.isLoading=!0,this.isDisabled=!0;const i=new FormData;i.append("file-to-upload",this.imgFile);const{VITE_API:s,VITE_API_PATH:c}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist",MODE:"production",DEV:!1,PROD:!0,SSR:!1},_=`${s}/api/${c}/admin/upload`;this.$http.post(_,i).then(t=>{this.previewImg={},tempProduct.imageUrl=t.data.imageUrl,alert("成功上傳圖片")}).catch(t=>{alert(`圖片上傳失敗，錯誤代碼：${t.response.status}`)}).finally(()=>{this.isLoading=!1,this.isDisabled=!1})}}},J={ref:"modal",class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1"},K={class:"modal-dialog modal-xl modal-dialog-scrollable"},Q={class:"modal-header bg-dark"},X={class:"modal-title text-light",id:"productModalLabel"},Y={key:0},Z={key:1},ee=["onClick"],te={class:"modal-body"},se={class:"container-fluid"},oe={class:"row"},le={class:"col-md-4"},ie={class:"mb-5"},ne=e("label",{for:"imageUrl",class:"form-label"},[b("主要圖片"),e("span",{class:"text-danger ms-1"},"*")],-1),ae={class:"position-relative mb-1"},de={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},re=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),ce=[re],ue=e("label",{for:"uploadImageUrl",class:"form-label mt-3 mb-1"},"或上傳圖片",-1),me={for:"uploadImageUrl",class:"form-label mb-1 btn btn-outline-secondary w-100 position-relative"},pe=["src","alt"],_e=["disabled"],he=["src"],be=e("h3",{class:"mb-3"},"多圖新增",-1),ge=["onUpdate:modelValue"],fe=["src"],ve=["onClick"],Pe=e("hr",{class:"my-4"},null,-1),ye={class:"col-md-8"},ke={class:"mb-3"},xe=e("label",{for:"title",class:"form-label"},[b("標題"),e("span",{class:"text-danger ms-1"},"*")],-1),we={class:"position-relative mb-1"},Ve={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Ie=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Ue=[Ie],Me={class:"mb-3 row"},Ee={class:"col"},Te=e("label",{for:"category",class:"form-label"},[b("分類"),e("span",{class:"text-danger ms-1"},"*")],-1),Ae={class:"position-relative mb-1"},$e={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Ce=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),De=[Ce],Se={class:"col"},Ne=e("label",{for:"unit",class:"form-label"},[b("單位"),e("span",{class:"text-danger ms-1"},"*")],-1),Le={class:"position-relative mb-1"},Re={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Fe=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Oe=[Fe],qe={class:"mb-3 row"},Be={class:"col"},He=e("label",{for:"origin_price",class:"form-label"},[b("原價"),e("span",{class:"text-danger ms-1"},"*")],-1),ze={class:"position-relative mb-1"},je={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},We=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Ge=[We],Je={class:"col"},Ke=e("label",{for:"price",class:"form-label"},[b("售價"),e("span",{class:"text-danger ms-1"},"*")],-1),Qe={class:"position-relative mb-1"},Xe={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},Ye=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),Ze=[Ye],et={class:"mb-3"},tt=e("label",{for:"description",class:"form-label"},[b("產品描述"),e("span",{class:"text-danger ms-1"},"*")],-1),st={class:"position-relative mb-1"},ot={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},lt=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),it=[lt],nt={class:"mb-3"},at=e("label",{for:"content",class:"form-label"},[b("說明內容"),e("span",{class:"text-danger ms-1"},"*")],-1),dt={class:"position-relative mb-1"},rt={key:0,class:"position-absolute top-50 end-0 translate-middle-y px-3 pb-1"},ct=e("span",{class:"material-icons-outlined text-danger align-middle"},"error_outline",-1),ut=[ct],mt={class:"form-check"},pt=e("label",{class:"form-check-label",for:"is_enable"},"是否啟用",-1),_t={class:"modal-footer"},ht=["onClick"],bt=e("button",{type:"submit",class:"btn btn-primary"},"確認",-1);function gt(i,s,c,_,t,o){const r=v("VField"),m=v("ErrorMessage"),f=v("VForm");return a(),d("div",J,[e("div",K,[u(f,{onSubmit:o.onSubmit,class:"modal-content border-0"},{default:$(({errors:n,handleReset:P})=>[e("div",Q,[e("h5",X,[c.isNew?(a(),d("span",Y,"新增產品")):(a(),d("span",Z,"編輯產品"))]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close",onClick:l=>P()},null,8,ee)]),e("div",te,[e("div",se,[e("div",oe,[e("div",le,[e("div",ie,[ne,e("div",ae,[u(r,{type:"text",name:"imageUrl",id:"imageUrl",class:p(["form-control",{"border-danger":n.imageUrl}]),placeholder:"請輸入圖片連結",rules:"required",modelValue:t.tempProduct.imageUrl,"onUpdate:modelValue":s[0]||(s[0]=l=>t.tempProduct.imageUrl=l)},null,8,["modelValue","class"]),n.imageUrl?(a(),d("div",de,ce)):h("",!0)]),u(m,{name:"imageUrl",class:"d-block mb-0 text-danger"}),e("form",null,[ue,e("label",me,[b("選擇圖片 "),e("input",{type:"file",id:"uploadImageUrl",class:"opacity-0 position-absolute start-0",onChange:s[1]||(s[1]=l=>o.previewUpload(l))},null,32)]),t.previewImg.url?(a(),d("img",{key:0,src:t.previewImg.url,alt:t.previewImg.alt,class:"d-block mb-1 w-100"},null,8,pe)):h("",!0),e("div",{class:p({spinner:t.isLoading})},[e("button",{type:"button",class:"btn btn-secondary w-100",onClick:s[2]||(s[2]=(...l)=>o.uploadImg&&o.uploadImg(...l)),disabled:t.isDisabled},"確定上傳",8,_e)],2)]),t.tempProduct.imageUrl?(a(),d("img",{key:0,src:t.tempProduct.imageUrl,alt:"圖片",class:"w-100"},null,8,he)):h("",!0)]),e("div",null,[be,(a(!0),d(V,null,I(t.tempProduct.imagesUrl,(l,k)=>(a(),d("div",{key:l},[w(e("input",{type:"text",name:"imagesUrl",class:"form-control mb-2",placeholder:"請輸入圖片連結","onUpdate:modelValue":U=>t.tempProduct.imagesUrl[k]=U},null,8,ge),[[C,t.tempProduct.imagesUrl[k]]]),w(e("img",{class:"mb-2 w-100",src:l,alt:"圖片"},null,8,fe),[[S,l]]),e("button",{type:"button",class:"btn btn-outline-danger w-100",onClick:U=>t.tempProduct.imagesUrl.splice(k,1)},"刪除圖片",8,ve),Pe]))),128)),e("button",{type:"button",class:"btn btn-outline-primary w-100",onClick:s[3]||(s[3]=l=>t.tempProduct.imagesUrl.push(""))},"新增更多圖片")])]),e("div",ye,[e("div",ke,[xe,e("div",we,[u(r,{type:"text",name:"title",id:"title",class:p(["form-control",{"border-danger":n.title}]),placeholder:"請輸入標題",rules:"required",modelValue:t.tempProduct.title,"onUpdate:modelValue":s[4]||(s[4]=l=>t.tempProduct.title=l)},null,8,["modelValue","class"]),n.title?(a(),d("div",Ve,Ue)):h("",!0)]),u(m,{name:"title",class:"d-block mb-0 text-danger"})]),e("div",Me,[e("div",Ee,[Te,e("div",Ae,[u(r,{type:"text",name:"category",id:"category",class:p(["form-control",{"border-danger":n.category}]),placeholder:"請輸入分類",rules:"required",modelValue:t.tempProduct.category,"onUpdate:modelValue":s[5]||(s[5]=l=>t.tempProduct.category=l)},null,8,["modelValue","class"]),n.category?(a(),d("div",$e,De)):h("",!0)]),u(m,{name:"category",class:"d-block mb-0 text-danger"})]),e("div",Se,[Ne,e("div",Le,[u(r,{type:"text",name:"unit",id:"unit",class:p(["form-control",{"border-danger":n.unit}]),placeholder:"請輸入單位",rules:"required",modelValue:t.tempProduct.unit,"onUpdate:modelValue":s[6]||(s[6]=l=>t.tempProduct.unit=l)},null,8,["modelValue","class"]),n.unit?(a(),d("div",Re,Oe)):h("",!0)]),u(m,{name:"unit",class:"d-block mb-0 text-danger"})])]),e("div",qe,[e("div",Be,[He,e("div",ze,[u(r,{type:"text",name:"origin_price",id:"origin_price",class:p(["form-control",{"border-danger":n.origin_price}]),placeholder:"請輸入原價",rules:"required|min_value:0",modelValue:t.tempProduct.origin_price,"onUpdate:modelValue":s[7]||(s[7]=l=>t.tempProduct.origin_price=l),modelModifiers:{number:!0}},null,8,["modelValue","class"]),n.origin_price?(a(),d("div",je,Ge)):h("",!0)]),u(m,{name:"origin_price",class:"d-block mb-0 text-danger"})]),e("div",Je,[Ke,e("div",Qe,[u(r,{type:"text",name:"price",id:"price",class:p(["form-control",{"border-danger":n.price}]),placeholder:"請輸入售價",rules:"required|min_value:0",modelValue:t.tempProduct.price,"onUpdate:modelValue":s[8]||(s[8]=l=>t.tempProduct.price=l),modelModifiers:{number:!0}},null,8,["modelValue","class"]),n.price?(a(),d("div",Xe,Ze)):h("",!0)]),u(m,{name:"price",class:"d-block mb-0 text-danger"})])]),e("div",et,[tt,e("div",st,[u(r,{as:"textarea",name:"description",id:"description",rows:"3",class:p(["form-control",{"border-danger":n.description}]),placeholder:"請輸入產品描述",rules:"required",modelValue:t.tempProduct.description,"onUpdate:modelValue":s[9]||(s[9]=l=>t.tempProduct.description=l)},null,8,["modelValue","class"]),n.description?(a(),d("div",ot,it)):h("",!0)]),u(m,{name:"description",class:"d-block mb-0 text-danger"})]),e("div",nt,[at,e("div",dt,[u(r,{as:"textarea",name:"content",id:"content",rows:"3",class:p(["form-control",{"border-danger":n.content}]),placeholder:"請輸入說明內容",rules:"required",modelValue:t.tempProduct.content,"onUpdate:modelValue":s[10]||(s[10]=l=>t.tempProduct.content=l)},null,8,["modelValue","class"]),n.content?(a(),d("div",rt,ut)):h("",!0)]),u(m,{name:"content",class:"d-block mb-0 text-danger"})]),e("div",mt,[w(e("input",{type:"checkbox",name:"is_enabled",id:"is_enable",class:"form-check-input","onUpdate:modelValue":s[11]||(s[11]=l=>t.tempProduct.is_enabled=l)},null,512),[[D,t.tempProduct.is_enabled]]),pt])])])])]),e("div",_t,[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:l=>P()},"取消",8,ht),bt])]),_:1},8,["onSubmit"])])],512)}const ft=y(G,[["render",gt]]),vt={mixins:[M],emits:["delProduct"],props:["temp"],data(){return{modal:{}}}},Pt={ref:"modal",class:"modal fade","data-bs-keyboard":"false",tabindex:"-1"},yt={class:"modal-dialog"},kt={class:"modal-content border-0"},xt=e("div",{class:"modal-header bg-danger"},[e("h5",{class:"modal-title text-light",id:"productModalLabel"},[e("span",null,"刪除產品")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),wt={class:"modal-body"},Vt={class:"text-danger"},It={class:"modal-footer"},Ut=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function Mt(i,s,c,_,t,o){return a(),d("div",Pt,[e("div",yt,[e("div",kt,[xt,e("div",wt,[e("p",null,[b("是否刪除 "),e("span",Vt,g(c.temp.title),1),b(" 商品（刪除後將無法恢復）")])]),e("div",It,[Ut,e("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=r=>i.$emit("delProduct",c.temp.id))},"確認刪除")])])])],512)}const Et=y(vt,[["render",Mt]]),Tt={components:{Pagination:W,ProductModal:ft,DelModal:Et},data(){return{products:[],tempProduct:{},pagination:{},isNew:""}},methods:{getProducts(i=1){const s=this.$loading.show(),{VITE_API:c,VITE_API_PATH:_}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=`${c}/api/${_}/admin/products?page=${i}`;this.$http.get(t).then(o=>{this.products=o.data.products,this.pagination=o.data.pagination}).catch(o=>{alert(`取得產品失敗，錯誤代碼：${o.response.status}`)}).finally(()=>s.hide())},openModal(i,s){if(this.tempProduct={...s},i==="del"){this.$refs.delModal.openModal();return}else i==="new"?(this.isNew=!0,this.tempProduct={imagesUrl:[]}):i==="edit"&&(this.isNew=!1);this.$refs.productModal.openModal()},updateProd(i,s){const c=this.$loading.show(),{VITE_API:_,VITE_API_PATH:t}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let o=`${_}/api/${t}/admin/product`,r="post",m="新增";this.isNew===!1&&(o+=`/${s}`,r="put",m="編輯"),this.$http[r](o,{data:{...i}}).then(f=>{setTimeout(()=>alert(`${f.data.message}`),1e3),this.$refs.productModal.hideModal(),this.getProducts()}).catch(f=>{alert(`${m}產品失敗，錯誤代碼：${f.response.status}`)}).finally(()=>c.hide())},delProduct(i){const s=this.$loading.show(),{VITE_API:c,VITE_API_PATH:_}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"practice_chien",BASE_URL:"/task_vue_weekly/week7/dist",MODE:"production",DEV:!1,PROD:!0,SSR:!1},t=`${c}/api/${_}/admin/product/${i}`;this.$http.delete(t).then(o=>{setTimeout(()=>alert(`${o.data.message}`),1e3),this.$refs.delModal.hideModal(),this.getProducts()}).catch(o=>{alert(`刪除產品失敗，錯誤代碼：${o.response.status}`)}).finally(()=>s.hide())}},mounted(){this.getProducts()}},At={class:"container py-5"},$t=e("h2",{class:"mb-3'"},"產品列表",-1),Ct={class:"position-relative py-3"},Dt={class:"table align-middle"},St=e("thead",null,[e("tr",null,[e("th",null,"分類"),e("th",null,"產品名稱"),e("th",null,"原價"),e("th",null,"售價"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),Nt=["onClick"],Lt=["onClick"];function Rt(i,s,c,_,t,o){const r=v("Pagination"),m=v("ProductModal"),f=v("DelModal");return a(),d("div",At,[$t,e("div",Ct,[e("button",{type:"button",onClick:s[0]||(s[0]=n=>o.openModal("new")),class:"position-absolute bottom-100 end-0 btn btn-primary"},"建立新的產品"),e("table",Dt,[St,e("tbody",null,[(a(!0),d(V,null,I(t.products,n=>(a(),d("tr",{key:n.id},[e("td",null,g(n.category),1),e("td",null,g(n.title),1),e("td",null,g(n.origin_price),1),e("td",null,g(n.price),1),e("td",{class:p([n.is_enabled?"text-success":"text-danger"])},g(n.is_enabled?"啟用":"未啟用"),3),e("td",null,[e("button",{type:"button",class:"mb-1 mb-md-0 btn btn-outline-primary me-2",onClick:P=>o.openModal("edit",n)},"編輯",8,Nt),e("button",{type:"button",class:"btn btn-outline-danger",onClick:P=>o.openModal("del",n)},"刪除",8,Lt)])]))),128))])])]),e("p",null,"此頁共有 "+g(t.products.length)+" 項產品",1),t.pagination.total_pages?(a(),N(r,L({key:0},t.pagination,{onSwitchPage:o.getProducts}),null,16,["onSwitchPage"])):h("",!0),u(m,{ref:"productModal",temp:{...t.tempProduct},isNew:t.isNew,onUpdateProd:o.updateProd},null,8,["temp","isNew","onUpdateProd"]),u(f,{ref:"delModal",temp:{...t.tempProduct},onDelProduct:o.delProduct},null,8,["temp","onDelProduct"])])}const Ot=y(Tt,[["render",Rt]]);export{Ot as default};
